@{
    ViewBag.Title = "Counsellor";
}



<div id="page-content-wrapper">
    <div class="container-fluid">
        <div class="col-md-12 content-width dashboard">
            <div>
                @if (TempData["Message"] != null || TempData["Message"].ToString() != "")
                {
                    <label style="font:bold;color:forestgreen;font-size: medium;margin-right: 575px;" id="msgErroStudent" class="diff-hd">
                        @TempData["Message"]
                    </label>

                }
                <label id="tab" style="display:none"> @TempData["tab"]</label>
            </div>
            <button type="button" class="btn blue-btn" id="btnAddEvent" data-toggle="modal" data-target="#addNewEvent">
                Add Event
            </button>
            <br />
            <br />
            <div class="report-details-cover">
                <div id="calender"></div>
            </div>
            <div id="myModal" class="modal " role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">

                            <h4 class="modal-title"><span id="eventTitle"></span></h4>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <div class="modal-body">
                            <p id="pDetails"></p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="col-md-12" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Modal -->
            <div class="modal fade cmn-modal" id="addNewEvent" tabindex="-1" role="dialog" aria-labelledby="addNewEventLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addNewEventLabel">Add New</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="modal-main-content">
                                <div class="row">
                                    <div class="form-group col-12">
                                        <label>Title<sup>*</sup></label>
                                        <input type="text" id="txtTitle" class="form-control" />
                                        <label id="lblmsgTitle" style="display:none; color:red"></label>
                                    </div>
                                    <div class="form-group col-12">
                                        <label>Add Place<sup>*</sup></label>
                                        <input type="text" id="txtPlace" class="form-control" />
                                        <label id="lblmsgAddPlace" style="display:none; color:red"></label>
                                    </div>
                                    @*<div class="form-group col-12">
                                            <label>Date<sup>*</sup></label>
                                            <div class="d-flex justify-content-between flex-column" style="height: 100px;">
                                                <input type="date" class="form-control" id="txtFromDate" placeholder="from" />
                                                <label id="lblmsgDateFrom" style="display:none; color:red"></label>
                                                <span>To</span>
                                                <input type="date" class="form-control" id="txtToDate" placeholder="to" />
                                                <label id="lblmsgDateTo" style="display:none; color:red"></label>
                                            </div>
                                        </div>*@

                                    <div class="form-group col-12">
                                        <label>Date & Time<sup>*</sup></label>
                                        <div class="d-flex justify-content-between flex-row">
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="txtFromDate" />
                                            </div>
                                            <span class="align-self-center col-1 text-center p-0">To</span>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="txtToDate" />
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group col-sm-12 col-12">
                                        <label>Description<sup>*</sup></label>
                                        <textarea rows="2" id="txtDescription" class="form-control"></textarea>
                                        <label id="lblmsgDescription" style="display:none; color:red"></label>

                                    </div>
                                    <div class="form-group col-sm-12 col-12">
                                        <div class="selectdiv">
                                            @Html.DropDownList("Name", (IEnumerable<SelectListItem>)ViewBag.StudentList, new { @id = "ddlStudent", @class = "form-control", @multiple = true, @title = "Student list" })
                                            <label id="lblmsgStudent" style="display:none; color:red"></label>
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-12 col-12">
                                        <label>Color<sup>*</sup></label>
                                        <div class="selectdiv">
                                            <select id="ddlColorName">
                                                <option selected=""> Choose Color </option>
                                                <option style="color:RED;font-weight: bold" value="RED">RED</option>
                                                <option style="color:DEEPPINK;font-weight: bold" value="DEEPPINK">DEEPPINK</option>
                                                <option style="color:ORANGE;font-weight: bold" value="ORANGE">ORANGE</option>
                                                <option style="color:YELLOW;font-weight: bold" value="YELLOW">YELLOW</option>
                                                <option style="color:PURPLE;font-weight: bold" value="PURPLE">PURPLE</option>
                                                <option style="color:LIME;font-weight: bold" value="LIME">LIME</option>
                                                <option style="color:GREEN;font-weight: bold" value="GREEN">GREEN</option>
                                                <option style="color:CYAN;font-weight: bold" value="CYAN">CYAN</option>
                                                <option style="color:BLUE;font-weight: bold" value="BLUE">BLUE</option>
                                            </select>
                                            <label id="lblmsgColorName" style="display:none; color:red"></label>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-center bttn-box mt-2">
                                <button type="submit" id="Submit" class="btn blue-btn"> Add </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>
</div>



<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

@*<link href="/multiselect/css/jquery.multiselect.css" rel="stylesheet" />
    <script src="/multiselect/js/jquery.multiselect.js"></script>*@

<link href="~/Scripts/MultiSelect/jquery-ui.css" rel="stylesheet" />
<link href="~/Scripts/MultiSelect/jquery.multiselect.css" rel="stylesheet" />
<link href="~/Scripts/MultiSelect/jquery.multiselect.filter.css" rel="stylesheet" />
<link href="~/Scripts/MultiSelect/prettify.css" rel="stylesheet" />

<script src="~/Scripts/MultiSelect/Jquery-ui.min.js"></script>
<script src="~/Scripts/MultiSelect/jquery.multiselect.filter.js"></script>
<script src="~/Scripts/MultiSelect/jquery.multiselect.js"></script>
<script src="~/Scripts/MultiSelect/jquery.multiselect.min.js"></script>
<script src="~/Scripts/MultiSelect/prettify.js"></script>

<link rel="stylesheet" href="/css/bootstrap-datetimepicker.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.21.0/moment.min.js" type="text/javascript"></script>
<script src="/Scripts/bootstrap-datetimepicker.min.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
        var events = [];
        $.ajax({
            type: "GET",
            url: "/home/GetEvents",
            success: function (data) {
                $.each(data, function (i, v) {
                    events.push({
                        title: v.Subject,
                        description: v.Description,
                        start: moment(v.Start),
                        end: v.End != null ? moment(v.End) : null,
                        color: v.ThemeColor,
                        allDay: v.IsFullDay
                    });
                })

                GenerateCalender(events);
            },
            error: function (error) {
                alert('failed');
            }
        })

        function GenerateCalender(events) {
            $('#calender').fullCalendar('destroy');
            $('#calender').fullCalendar({
                contentHeight: 400,
                defaultDate: new Date(),
                timeFormat: 'h(:mm)a',
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,basicWeek,basicDay'
                },
                eventLimit: true,
                eventColor: '#378006',
                events: events,
                eventClick: function (calEvent, jsEvent, view) {
                    $('#myModal #eventTitle').text(calEvent.title);
                    var $description = $('<div/>');
                    $description.append($('<p/>').html('<b>Start:</b>' + calEvent.start.format("DD-MMM-YYYY HH:mm a")));
                    if (calEvent.end != null) {
                        $description.append($('<p/>').html('<b>End:</b>' + calEvent.end.format("DD-MMM-YYYY HH:mm a")));
                    }
                    $description.append($('<p/>').html('<b>Description:</b>' + calEvent.description));
                    $('#myModal #pDetails').empty().html($description);

                    $('#myModal').modal();
                }
            })
        }

        $('#Submit').click(function () {
            let data = [];
            function escapeHtml(emailBody) {
                return emailBody
                    .replace(/&/g, "~amp;")
                    .replace(/</g, "~lt;")
                    .replace(/>/g, "~gt;")
                    .replace(/"/g, "~quot;")
                    .replace(/'/g, "~039;")
                    .replace(/#/g, "~040;");
            }


            var Title = $('#txtTitle').val();
            var Place = $('#txtPlace').val();
            var FromDate = $('#txtFromDate').val();
            var ToDate = $('#txtToDate').val();
            var Description = $('#txtDescription').val();
            var StudentId = $('#ddlStudent :selected').val();
            var ColorName = $('#ddlColorName').val();


            if (Title == '' || Title == null) {
                $('#lblmsgTitle').text('Please enter Title.');
                $('#lblmsgTitle').show();
                $('#txtTitle').focus();
                return;
            } else {
                $('#lblmsgTitle').text('');
                $('#lblmsgTitle').hide();
            }

            if (Place == '' || Place == null) {
                $('#lblmsgAddPlace').text('Please enter place.');
                $('#lblmsgAddPlace').show();
                $('#txtPlace').focus();
                return;
            } else {
                $('#lblmsgAddPlace').text('');
                $('#lblmsgAddPlace').hide();
            }
            if (FromDate == '' || FromDate == null) {
                $('#lblmsgDateFrom').text('Please enter date.');
                $('#lblmsgDateFrom').show();
                $('#txtFromDate').focus();
                return;
            } else {
                $('#lblmsgDateFrom').text('');
                $('#lblmsgDateFrom').hide();
            }
            if (ToDate == '' || ToDate == null) {
                $('#lblmsgDateTo').text('Please enter date.');
                $('#lblmsgDateTo').show();
                $('#txtToDate').focus();
                return;
            } else {
                $('#lblmsgDateTo').text('');
                $('#lblmsgDateTo').hide();
            }
            if (Description == '' || Description == null) {
                $('#lblmsgDescription').text('Please enter description.');
                $('#lblmsgDescription').show();
                $('#txtDescription').focus();
                return;
            } else {
                $('#lblmsgDescription').text('');
                $('#lblmsgDescription').hide();
            }
            if (StudentId == '' || StudentId == null || StudentId == 'undefined') {
                $('#lblmsgStudent').text('Please select student.');
                $('#lblmsgStudent').show();
                $('#MddlStudent').focus();
                return;
            } else {
                $('#lblmsgStudent').text('');
                $('#lblmsgStudent').hide();
            }
            if (ColorName == 'Choose Color' || ColorName == null) {
                $('#lblmsgColorName').text('Please select color.');
                $('#lblmsgColorName').show();
                $('#ddlColorName').focus();
                return;
            } else {
                $('#lblmsgColorName').text('');
                $('#lblmsgColorName').hide();
            }


            $('#ddlStudent :selected').each(function () {
                let StudentId = $(this).val();
                let Title = $('#txtTitle').val();
                let Place = $('#txtPlace').val();
                let FromDate = $('#txtFromDate').val();
                let ToDate = $('#txtToDate').val();
                let Description = $('#txtDescription').val();
                let ColorName = $('#ddlColorName').val();

                Title = escapeHtml(Title),
                    Place = escapeHtml(Place),
                    FromDate = escapeHtml(FromDate),
                    ToDate = escapeHtml(ToDate),
                    StudentId = escapeHtml(StudentId),
                    Description = escapeHtml(Description),
                    ColorName = escapeHtml(ColorName)

                data.push({
                    Title: Title,
                    Place: Place,
                    FromDate: FromDate,
                    ToDate: ToDate,
                    StudentId: StudentId,
                    Description: Description,
                    ColorName: ColorName
                });
            });
            $("#Submit").text('Processing...');
            $("#Submit").attr("disabled", true);
            var json = JSON.stringify(data);
            $.ajax
                ({
                    url: "/Home/InsertEventDetails?json=" + json + "",
                    type: "Get",
                    success: function (drr) {
                        $("#Submit").text('Add');
                        $("#Submit").attr("disabled", false);
                        var tab = "FormatGrid";
                        var StrMain = "Record has been save successfully.";
                        var url = "/Home/CounsellorCalendar/?StrMain=" + StrMain;
                        window.location.href = url;
                    },
                    Error: function (err) {
                        Console.log(err);
                    }
                });


        });

    })

        $(window).on('load', function () {
            //$('#MddlCounsellor_checklist').css('position', 'relative');
            //$('#MddlCounsellor_checklist').css('height', '100px');
            //$('#MddlCounsellor_checklist').css('width', '100%');

            //$('#MddlCounsellor_findInList').css('width', '100%');
            //$('#MddlCounsellor').css('width', '100%');

            //$('#MddlStudent_checklist').css('position', 'relative');
            //$('#MddlStudent_checklist').css('height', '100px');
            //$('#MddlStudent_checklist').css('width', '100%');

            //$('#MddlStudent_findInList').css('width', '100%');
            //$('#MddlStudent').css('width', '100%');

            setTimeout(function () { $("#msgErroStudent").hide(); }, 4000);
        });

</script>

@*<script>
        $('#MddlStudent').multiselect({
            columns: 1,
            search: true,
            selectAll: true
        });
    </script>*@


<script type="text/javascript">
    (function ($) {
        $(function () {
            $("#txtFromDate").datetimepicker();
            $("#txtToDate").datetimepicker();
        });
    })(jQuery);
</script>


<script>

    $("#ddlStudent").multiselect({
        noneSelectedText: "Select student"
    }).multiselectfilter();

    var multiselectSelddlStudent = $($('input[name="multiselect_ddlStudent"]')[0]).closest('div.ui-multiselect-menu');
    $(multiselectSelddlStudent).find('.ui-multiselect-all, .ui-multiselect-none, .ui-icon-check, .ui-icon-closethick').show();
</script>


